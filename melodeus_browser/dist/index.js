(()=>{var e,t,n,o,r={},a={};function i(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={exports:{}};return r[e](n,n.exports,i),n.exports}i.m=r,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(n,o){if(1&o&&(n=this(n)),8&o)return n;if("object"==typeof n&&n){if(4&o&&n.__esModule)return n;if(16&o&&"function"==typeof n.then)return n}var r=Object.create(null);i.r(r);var a={};e=e||[null,t({}),t([]),t(t)];for(var c=2&o&&n;("object"==typeof c||"function"==typeof c)&&!~e.indexOf(c);c=t(c))Object.getOwnPropertyNames(c).forEach(e=>a[e]=()=>n[e]);return a.default=()=>n,i.d(r,a),r},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce((t,n)=>(i.f[n](e,t),t),[])),i.u=e=>e+".js",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n={},o="melodeus-browser:",i.l=(e,t,r,a)=>{if(n[e])n[e].push(t);else{var c,s;if(void 0!==r)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==o+r){c=u;break}}c||(s=!0,(c=document.createElement("script")).charset="utf-8",i.nc&&c.setAttribute("nonce",i.nc),c.setAttribute("data-webpack",o+r),c.src=e),n[e]=[t];var p=(t,o)=>{c.onerror=c.onload=null,clearTimeout(m);var r=n[e];if(delete n[e],c.parentNode&&c.parentNode.removeChild(c),r&&r.forEach(e=>e(o)),t)return t(o)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:c}),12e4);c.onerror=p.bind(null,c.onerror),c.onload=p.bind(null,c.onload),s&&document.head.appendChild(c)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={57:0};i.f.j=(t,n)=>{var o=i.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var r=new Promise((n,r)=>o=e[t]=[n,r]);n.push(o[2]=r);var a=i.p+i.u(t),c=new Error;i.l(a,n=>{if(i.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var r=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;c.message="Loading chunk "+t+" failed.\n("+r+": "+a+")",c.name="ChunkLoadError",c.type=r,c.request=a,o[1](c)}},"chunk-"+t,t)}};var t=(t,n)=>{var o,r,[a,c,s]=n,l=0;if(a.some(t=>0!==e[t])){for(o in c)i.o(c,o)&&(i.m[o]=c[o]);s&&s(i)}for(t&&t(n);l<a.length;l++)r=a[l],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0},n=self.webpackChunkmelodeus_browser=self.webpackChunkmelodeus_browser||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),i.e(300).then(i.t.bind(i,300,23)).then(function(e){let t=null,n="",o="",r=!1,a=!1;const i={microphone:"prompt"},c=document.getElementById("output-devices"),s=document.getElementById("input-devices"),l=document.getElementById("refresh-devices"),d=document.getElementById("play"),u=document.getElementById("stop"),p=document.getElementById("device-status"),m=document.getElementById("device-info"),f=document.getElementById("request-permission"),h=document.getElementById("start-monitor"),y=document.getElementById("stop-monitor"),v=document.getElementById("input-waveform"),g=v?v.getContext("2d"):null,b={audioContext:null,analyser:null,animationId:null,dataArray:null,mediaStream:null,source:null},w=new Map,E=(()=>{if("boolean"==typeof window.isSecureContext&&window.isSecureContext)return!0;const{protocol:e,hostname:t}=window.location;return"https:"===e||"localhost"===t||"127.0.0.1"===t||"[::1]"===t})(),A=(e="")=>{p&&(p.textContent=e)},S=(e,t)=>{const n=e?`${e}: ${String(t)}`:String(t);console.error(n),A(n)},I=()=>A(""),k=()=>{const e="Microphone input is only available over HTTPS or localhost. Reopen this page securely and try again.";console.warn(e),A(e)},C=()=>!!E||(k(),!1),x=()=>{h&&(h.disabled=r||a||!E),y&&(y.disabled=!r),(()=>{if(!f)return;if(!E)return f.value="Use HTTPS to enable microphone",void(f.disabled=!0);if(a)return f.value="Requesting...",void(f.disabled=!0);const e=i.microphone;"granted"===e?(f.value="Microphone enabled",f.disabled=!0):"denied"===e?(f.value="Retry microphone access",f.disabled=!1):(f.value="Enable microphone",f.disabled=!1)})()},T=e=>{"granted"!==e&&"denied"!==e&&"prompt"!==e||(i.microphone=e,x())},j=async()=>{if(!C())return!1;if(!navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return S("Browser does not support audio capture",""),!1;try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(e=>e.stop()),T("granted"),I(),await O(),!0}catch(e){const t=e&&e.name?e.name:"";return"NotAllowedError"===t||"SecurityError"===t?(T("denied"),E?S("Microphone access denied",""):k()):S("Unable to access microphone",e),!1}},B=(e,t,n,o)=>{if(!e)return o??"";const r=Array.isArray(t)?t:[],a=o??e.value;e.textContent="";const i=document.createElement("option");i.value="",i.textContent=n?`System default (${n})`:"System default",e.appendChild(i),r.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)});const c=new Set(r);return a&&c.has(a)?(e.value=a,a):n&&c.has(n)?(e.value=n,n):(e.value="","")},O=async()=>{if(navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.enumerateDevices)try{const e=await navigator.mediaDevices.enumerateDevices();w.clear();for(const t of e)if("audioinput"===t.kind){const e=t.label||t.deviceId;w.set(e,t)}}catch(e){console.warn("Unable to enumerate browser media devices",e)}},P=async e=>{if(!e)return null;w.has(e)||await O();const t=w.get(e);return t?t.deviceId:null},_=async()=>{try{const t=await e.get_audio_devices(),r=Array.isArray(t.outputs)?Array.from(t.outputs):[],a=Array.isArray(t.inputs)?Array.from(t.inputs):[];(e=>{if(!m)return;const t=Array.isArray(e.inputInfo)?Array.from(e.inputInfo):[],n=Array.isArray(e.outputInfo)?Array.from(e.outputInfo):[],o=e=>"number"==typeof e&&Number.isFinite(e)?`${e} Hz`:"? Hz",r=e=>"number"==typeof e&&Number.isFinite(e)?`${e} ch`:"? ch",a=[];if(a.push("Input devices:"),0===t.length)a.push("  (none)");else for(const e of t){const t=e.name||e.deviceId||"Unknown input";a.push(`  - ${t}: ${o(e.sampleRate)}, ${r(e.channels)}`)}if(a.push("Output devices:"),0===n.length)a.push("  (none)");else for(const e of n){const t=e.name||"Unknown output";a.push(`  - ${t}: ${o(e.sampleRate)}, ${r(e.channels)}`)}m.textContent=a.join("\n")})(t),n=B(c,r,t.defaultOutput??null,n),o=B(s,a,t.defaultInput??null,o),0===r.length?A("No output devices detected"):0===a.length?A("No input devices detected"):I()}catch(e){S("Unable to enumerate audio devices",e)}await O()},M=()=>{if(null!==b.animationId&&(cancelAnimationFrame(b.animationId),b.animationId=null),b.source){try{b.source.disconnect()}catch(e){console.warn("Failed to disconnect input source",e)}b.source=null}b.analyser&&b.analyser.disconnect(),b.mediaStream&&(b.mediaStream.getTracks().forEach(e=>e.stop()),b.mediaStream=null),b.audioContext&&(b.audioContext.close().catch(e=>{console.warn("Failed to close audio context",e)}),b.audioContext=null),b.analyser=null,b.dataArray=null,r=!1,v&&g&&g.clearRect(0,0,v.width,v.height),x()},U=()=>{if(!v||!g||!b.analyser)return void(b.animationId=null);const{analyser:e,dataArray:t}=b;e.getByteTimeDomainData(t),g.fillStyle="#202020",g.fillRect(0,0,v.width,v.height),g.lineWidth=2,g.strokeStyle="#4caf50",g.beginPath();const n=v.width/t.length;let o=0;for(let e=0;e<t.length;e+=1){const r=t[e]/128*v.height/2;0===e?g.moveTo(o,r):g.lineTo(o,r),o+=n}g.lineTo(v.width,v.height/2),g.stroke(),b.animationId=window.requestAnimationFrame(U)},$=async()=>{if(C())if(navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia){a=!0,x();try{let e=await P(o);if(o&&o.length>0&&!e&&"granted"!==i.microphone){if(!await j())return;e=await P(o)}const t=!(e&&e.length>0)||{deviceId:{exact:e}},n=await navigator.mediaDevices.getUserMedia({audio:t});T("granted"),M();const a=window.AudioContext||window.webkitAudioContext;if(!a)return n.getTracks().forEach(e=>e.stop()),void S("Web Audio API not supported","");const c=new a;"suspended"===c.state&&await c.resume();const s=c.createMediaStreamSource(n),l=c.createAnalyser();l.fftSize=2048,b.audioContext=c,b.mediaStream=n,b.source=s,b.analyser=l,b.dataArray=new Uint8Array(l.fftSize),s.connect(l),r=!0,U(),await O()}catch(e){const t=e&&e.name?e.name:"";"NotAllowedError"===t||"SecurityError"===t?(T("denied"),E?S("Microphone access denied",""):k()):S("Unable to monitor input device",e)}finally{a=!1,x()}}else S("Browser does not support audio capture","")};c&&c.addEventListener("change",()=>{n=c.value}),s&&s.addEventListener("change",()=>{o=s.value,r&&$()}),l&&l.addEventListener("click",async()=>{I(),await _()}),d&&d.addEventListener("click",()=>{I(),t&&(t.free(),t=null);try{const o=n&&n.length>0?n:null;t=e.beep_with_output_device(o)}catch(e){S("Failed to start playback",e)}}),u&&u.addEventListener("click",()=>{t&&(t.free(),t=null)}),f&&f.addEventListener("click",async()=>{a=!0,x();try{await j()}finally{a=!1,x()}}),h&&h.addEventListener("click",()=>{I(),$()}),y&&y.addEventListener("click",()=>{M()}),E||k(),navigator.permissions&&"function"==typeof navigator.permissions.query?navigator.permissions.query({name:"microphone"}).then(e=>{T(e.state),e.onchange=()=>T(e.state)}).catch(e=>{console.warn("Unable to query microphone permission",e),x()}):x(),x(),_()}).catch(e=>console.error("Failed to load melodeus-browser WASM module",e))})();